<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Case Battle Arena - Premium</title>
  
  <!-- GSAP -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <!-- Howler.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: #0f0f12;
      color: #fff;
      overflow-x: hidden;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ============================================
       HEADER
       ============================================ */
    .header {
      background: #1a1a1d;
      border-bottom: 1px solid #2a2a2f;
      padding: 16px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
    }

    .header-left {
      display: flex;
      gap: 24px;
      align-items: center;
    }

    .balance {
      font-size: 14px;
      color: #888;
    }

    .balance-value {
      font-size: 20px;
      font-weight: 700;
      color: #00ffff;
      text-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
    }

    .header-center h1 {
      font-size: 24px;
      font-weight: 900;
      letter-spacing: 2px;
      background: linear-gradient(135deg, #00ffff, #ffd700);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header-right {
      display: flex;
      gap: 12px;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      transition: all 0.3s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, #00ffff, #8a2be2);
      color: #000;
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 40px rgba(0, 255, 255, 0.6);
    }

    .btn-secondary {
      background: rgba(0, 255, 255, 0.1);
      color: #00ffff;
      border: 1px solid #00ffff;
    }

    .btn-secondary:hover {
      background: rgba(0, 255, 255, 0.2);
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
    }

    /* ============================================
       MAIN ARENA
       ============================================ */
    .arena {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 40px 24px;
      overflow-y: auto;
    }

    /* POT & ROUND INFO */
    .arena-header {
      text-align: center;
      margin-bottom: 40px;
    }

    .pot-display {
      font-size: 48px;
      font-weight: 900;
      color: #ffd700;
      text-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
      margin-bottom: 12px;
      animation: pot-pulse 2s ease-in-out infinite;
    }

    @keyframes pot-pulse {
      0%, 100% { text-shadow: 0 0 20px rgba(255, 215, 0, 0.4); }
      50% { text-shadow: 0 0 40px rgba(255, 215, 0, 0.8); }
    }

    .round-info {
      font-size: 14px;
      color: #888;
    }

    /* TEAM BARS */
    .team-bars {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 40px;
      max-width: 1000px;
      margin-left: auto;
      margin-right: auto;
      width: 100%;
    }

    .team-bar {
      background: #1a1a1d;
      border: 1px solid #2a2a2f;
      border-radius: 8px;
      padding: 16px;
      position: relative;
      overflow: hidden;
      min-height: 80px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .team-bar-label {
      font-size: 12px;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .team-bar-fill {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      background: linear-gradient(90deg, #00ffff, #00dd00);
      width: 0%;
      opacity: 0.3;
      border-radius: 8px;
      transition: width 0.5s ease;
    }

    .team-bar-content {
      position: relative;
      z-index: 2;
    }

    .team-bar-value {
      font-size: 28px;
      font-weight: 900;
      color: #00ffff;
    }

    /* PLAYER CARDS GRID */
    .players-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      max-width: 1000px;
      margin: 0 auto;
      width: 100%;
    }

    .team-column {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .player-card {
      background: #1a1a1d;
      border: 1px solid #2a2a2f;
      border-radius: 12px;
      padding: 20px;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
      cursor: pointer;
      min-height: 280px;
      display: flex;
      flex-direction: column;
    }

    .player-card:hover {
      transform: translateY(-4px);
      border-color: #00ffff;
      box-shadow: 0 10px 40px rgba(0, 255, 255, 0.2);
    }

    .player-card.revealing {
      animation: card-reveal 0.6s ease-out;
    }

    @keyframes card-reveal {
      0% { transform: scale(0.95); opacity: 0.5; }
      100% { transform: scale(1); opacity: 1; }
    }

    /* Rarity glow border */
    .player-card.rarity-common {
      border-color: #808080;
    }
    .player-card.rarity-uncommon {
      border-color: #4169e1;
      box-shadow: 0 0 15px rgba(65, 105, 225, 0.3);
    }
    .player-card.rarity-rare {
      border-color: #9370db;
      box-shadow: 0 0 15px rgba(147, 112, 219, 0.3);
    }
    .player-card.rarity-epic {
      border-color: #ffd700;
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
    }
    .player-card.rarity-legendary {
      border-color: #ff6347;
      box-shadow: 0 0 15px rgba(255, 99, 71, 0.3);
    }

    /* AVATAR */
    .card-avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: 2px solid #00ffff;
      background: #2a2a2f;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      margin-bottom: 12px;
    }

    /* USERNAME */
    .card-username {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 16px;
      color: #fff;
    }

    /* CASE IMAGE */
    .card-case {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 16px;
      position: relative;
      min-height: 100px;
    }

    .case-reel {
      width: 100px;
      height: 100px;
      background: linear-gradient(135deg, #1a1a1d, #2a2a2f);
      border: 2px solid #00ffff;
      border-radius: 8px;
      overflow: hidden;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .reel-items {
      display: flex;
      flex-direction: column;
      gap: 0;
      position: relative;
      width: 100%;
      height: 100%;
    }

    .reel-item {
      width: 100%;
      height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      flex-shrink: 0;
      border-bottom: 1px solid #2a2a2f;
      background: linear-gradient(135deg, #1a1a1d, #2a2a2f);
    }

    .reel-item:last-child {
      border-bottom: none;
    }

    /* Highlight center item */
    .case-reel::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      height: 90%;
      border: 2px solid #ffd700;
      border-radius: 4px;
      pointer-events: none;
      z-index: 10;
      box-shadow: inset 0 0 20px rgba(255, 215, 0, 0.3), 0 0 20px rgba(255, 215, 0, 0.3);
    }

    /* VALUE DISPLAY */
    .card-value {
      font-size: 24px;
      font-weight: 900;
      color: #ffd700;
      text-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
      text-align: center;
      min-height: 32px;
    }

    .card-value.hidden {
      color: transparent;
    }

    /* ============================================
       WINNER OVERLAY
       ============================================ */
    .winner-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .winner-overlay.active {
      opacity: 1;
      pointer-events: all;
    }

    .winner-content {
      text-align: center;
      position: relative;
      z-index: 2;
    }

    .winner-text {
      font-size: 80px;
      font-weight: 900;
      letter-spacing: 4px;
      background: linear-gradient(135deg, #00ffff, #ffd700);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 20px;
      animation: winner-bounce 1s ease-out;
    }

    @keyframes winner-bounce {
      0% { transform: scale(0.5) rotateX(180deg); opacity: 0; }
      100% { transform: scale(1) rotateX(0deg); opacity: 1; }
    }

    .winner-button {
      margin-top: 40px;
      padding: 16px 40px;
      background: linear-gradient(135deg, #00ffff, #8a2be2);
      color: #000;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 700;
      text-transform: uppercase;
      cursor: pointer;
      box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
      transition: all 0.3s ease;
    }

    .winner-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 60px rgba(0, 255, 255, 0.8);
    }

    /* CONFETTI CANVAS */
    #confetti-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 9998;
    }

    /* ============================================
       RESPONSIVE
       ============================================ */
    @media (max-width: 768px) {
      .arena {
        padding: 20px 12px;
      }

      .pot-display {
        font-size: 32px;
      }

      .players-grid {
        grid-template-columns: 1fr;
      }

      .team-bars {
        grid-template-columns: 1fr;
      }

      .header {
        flex-direction: column;
        gap: 12px;
      }

      .header-left, .header-right {
        flex-wrap: wrap;
        justify-content: center;
      }

      .winner-text {
        font-size: 48px;
      }
    }
  </style>
</head>
<body>
  <!-- HEADER -->
  <div class="header">
    <div class="header-left">
      <div class="balance">
        BALANCE
        <div class="balance-value">$5,250.00</div>
      </div>
    </div>
    <div class="header-center">
      <h1>âš” CASE BATTLE</h1>
    </div>
    <div class="header-right">
      <button class="btn btn-secondary">Provably Fair</button>
      <button class="btn btn-primary">Join Battle</button>
    </div>
  </div>

  <!-- ARENA -->
  <div class="arena">
    <!-- POT & ROUND -->
    <div class="arena-header">
      <div class="pot-display" id="pot-display">$0.00</div>
      <div class="round-info" id="round-info">Round 1 / 25</div>
    </div>

    <!-- TEAM BARS -->
    <div class="team-bars">
      <div class="team-bar">
        <div class="team-bar-fill" id="team-a-fill"></div>
        <div class="team-bar-content">
          <div class="team-bar-label">Team A Total</div>
          <div class="team-bar-value" id="team-a-value">$0.00</div>
        </div>
      </div>
      <div class="team-bar">
        <div class="team-bar-fill" id="team-b-fill"></div>
        <div class="team-bar-content">
          <div class="team-bar-label">Team B Total</div>
          <div class="team-bar-value" id="team-b-value">$0.00</div>
        </div>
      </div>
    </div>

    <!-- PLAYER CARDS -->
    <div class="players-grid" id="players-grid">
      <!-- Generated by JS -->
    </div>
  </div>

  <!-- WINNER OVERLAY -->
  <div class="winner-overlay" id="winner-overlay">
    <div class="winner-content">
      <div class="winner-text" id="winner-text">TEAM A WINS!</div>
      <button class="winner-button" onclick="location.reload()">Play Again</button>
    </div>
  </div>

  <!-- CONFETTI CANVAS -->
  <canvas id="confetti-canvas"></canvas>

  <script>
    // ============================================
    // GAME STATE & CONFIG
    // ============================================
    const ITEMS = [
      { emoji: 'ðŸ”«', name: 'Weapon', value: 100 },
      { emoji: 'ðŸŽ®', name: 'Controller', value: 150 },
      { emoji: 'ðŸ’Ž', name: 'Diamond', value: 500 },
      { emoji: 'ðŸ‘‘', name: 'Crown', value: 800 },
      { emoji: 'ðŸ†', name: 'Trophy', value: 300 },
      { emoji: 'âš¡', name: 'Lightning', value: 200 },
      { emoji: 'ðŸŒŸ', name: 'Star', value: 250 },
      { emoji: 'ðŸ’°', name: 'Money', value: 600 },
      { emoji: 'ðŸŽ¯', name: 'Target', value: 350 },
      { emoji: 'ðŸ”¥', name: 'Fire', value: 450 }
    ];

    const gameState = {
      phase: 'waiting', // waiting | revealing | complete
      battleId: null,
      mode: 'normal',
      teamSize: 1,
      players: [],
      currentlyRevealing: null,
      battleData: null // Full battle object from API
    };

    const soundsConfig = {
      spin: new Howl({ src: ['data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAAB9AAACABAAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj=='] }),
      click: new Howl({ src: ['data:audio/wav;base64,UklGRkYGAABXQVZFZm10IBAAAAABAAEAQB8AAAB9AAACABAAZGF0YQpGBAAA'] }),
      ding: new Howl({ src: ['data:audio/wav;base64,UklGRmIGAABXQVZFZm10IBAAAAABAAEAQB8AAAB9AAACABAAZGF0YQpGBAAA'] })
    };

    // ============================================
    // LOAD BATTLE FROM API
    // ============================================
    async function loadBattleFromAPI() {
      const params = new URLSearchParams(window.location.search);
      const battleId = params.get('battleId') || 'demo';
      
      if (battleId === 'demo') {
        loadDemoPlayers();
        return;
      }

      try {
        const apiUrl = import.meta.env.VITE_API_URL || 'http://localhost:3000';
        const response = await fetch(`${apiUrl}/case-battles/${battleId}`);
        const data = await response.json();
        
        if (data.battle) {
          gameState.battleData = data.battle;
          gameState.battleId = battleId;
          gameState.mode = data.battle.mode || 'normal';
          gameState.teamSize = data.battle.teamSize || 1;
          
          // Convert battle.players array to gameState format
          const avatars = ['ðŸ‘¤', 'ðŸŽ®', 'ðŸ’»', 'ðŸ”¥', 'âš¡', 'ðŸ’Ž'];
          gameState.players = data.battle.players.map((p, idx) => {
            // Determine team assignment
            let team = 1;
            if (gameState.mode === 'group') {
              team = 1; // All same team in group mode
            } else {
              team = idx < gameState.teamSize ? 1 : 2; // Split by teamSize
            }
            
            return {
              id: p.userId || `p${idx}`,
              name: p.username || `Player ${idx + 1}`,
              value: p.totalItemValue || 0,
              team: team,
              avatar: avatars[idx % avatars.length],
              userId: p.userId,
              isBot: p.isBot || false,
              rarity: ['common', 'uncommon', 'rare', 'epic', 'legendary'][Math.floor(Math.random() * 5)]
            };
          });
          
          renderPlayers();
        }
      } catch (err) {
        console.error('Failed to load battle, using demo:', err);
        loadDemoPlayers();
      }
    }

    function loadDemoPlayers() {
      gameState.mode = 'normal';
      gameState.teamSize = 1;
      gameState.players = [
        { id: 1, name: 'Player 1', avatar: 'ðŸ‘¨', team: 1, value: 0, rarity: 'uncommon' },
        { id: 2, name: 'Player 2', avatar: 'ðŸ‘©', team: 1, value: 0, rarity: 'rare' },
        { id: 3, name: 'Player 3', avatar: 'ðŸ§”', team: 1, value: 0, rarity: 'epic' },
        { id: 4, name: 'Player 4', avatar: 'ðŸ‘±', team: 2, value: 0, rarity: 'uncommon' },
        { id: 5, name: 'Player 5', avatar: 'ðŸ§‘', team: 2, value: 0, rarity: 'rare' },
        { id: 6, name: 'Player 6', avatar: 'ðŸ‘´', team: 2, value: 0, rarity: 'legendary' }
      ];
      renderPlayers();
    }

    // ============================================
    // RENDER PLAYERS
    // ============================================
    function renderPlayers() {
      const grid = document.getElementById('players-grid');
      grid.innerHTML = '';

      // Split into teams
      const teamA = gameState.players.filter(p => p.team === 1);
      const teamB = gameState.players.filter(p => p.team === 2);

      const maxTeamSize = Math.max(teamA.length, teamB.length);

      // Create columns
      const colA = document.createElement('div');
      colA.className = 'team-column';
      const colB = document.createElement('div');
      colB.className = 'team-column';

      // Render Team A
      teamA.forEach(player => {
        const card = createPlayerCard(player);
        colA.appendChild(card);
      });

      // Render Team B
      teamB.forEach(player => {
        const card = createPlayerCard(player);
        colB.appendChild(card);
      });

      grid.appendChild(colA);
      grid.appendChild(colB);

      updateTeamTotals();
    }

    function createPlayerCard(player) {
      const card = document.createElement('div');
      card.id = `player-${player.id}`;
      card.className = `player-card rarity-${player.rarity}`;
      card.innerHTML = `
        <div class="card-avatar">${player.avatar}</div>
        <div class="card-username">${player.name}</div>
        <div class="card-case">
          <div class="case-reel" id="reel-${player.id}">
            <div class="reel-items" id="reel-items-${player.id}"></div>
          </div>
        </div>
        <div class="card-value hidden" id="value-${player.id}">$0.00</div>
      `;
      return card;
    }

    // ============================================
    // ANIMATIONS
    // ============================================
    async function revealPlayerCard(playerId) {
      const player = gameState.players.find(p => p.id === playerId);
      if (!player) return;

      gameState.currentlyRevealing = playerId;
      const card = document.getElementById(`player-${playerId}`);
      const reelContainer = document.getElementById(`reel-${playerId}`);
      const reelItemsContainer = document.getElementById(`reel-items-${playerId}`);
      const valueEl = document.getElementById(`value-${playerId}`);

      // 1. POPULATE REEL WITH RANDOM ITEMS
      reelItemsContainer.innerHTML = '';
      const reelItems = [];
      for (let i = 0; i < 20; i++) {
        const item = ITEMS[Math.floor(Math.random() * ITEMS.length)];
        reelItems.push(item);
        const itemEl = document.createElement('div');
        itemEl.className = 'reel-item';
        itemEl.textContent = item.emoji;
        reelItemsContainer.appendChild(itemEl);
      }

      // Choose winning item (pick 3rd to last for nice animation stop)
      const winningItem = reelItems[reelItems.length - 5];
      player.value = winningItem.value;

      // 2. SPIN REEL
      soundsConfig.spin.play();
      
      const finalPosition = -(reelItems.length - 5) * 100; // Position to show winning item
      
      gsap.to(reelItemsContainer, {
        y: finalPosition,
        duration: 3,
        ease: 'power2.inOut',
        onComplete: () => {
          // 3. LOCK CLICK
          soundsConfig.click.play();
          gsap.to(reelContainer, {
            boxShadow: '0 0 30px rgba(255, 215, 0, 0.8)',
            duration: 0.2,
            yoyo: true,
            repeat: 2
          });

          // 4. REVEAL VALUE
          valueEl.classList.remove('hidden');
          valueEl.textContent = '$' + winningItem.value.toLocaleString();

          // 5. COUNTER ANIMATION (small tick)
          const counter = { value: 0 };
          gsap.to(counter, {
            value: winningItem.value,
            duration: 0.8,
            ease: 'power2.out',
            onUpdate: () => {
              valueEl.textContent = '$' + Math.round(counter.value).toLocaleString();
            }
          });

          soundsConfig.ding.play();

          // 6. GLOW PULSE
          gsap.to(card, {
            boxShadow: `0 10px 40px rgba(0, 255, 255, 0.6)`,
            duration: 0.4,
            yoyo: true,
            repeat: 1
          });

          gameState.currentlyRevealing = null;
          updateTeamTotals();
        }
      });
    }

    // ============================================
    // TEAM TOTALS
    // ============================================
    function updateTeamTotals() {
      const teamA = gameState.players.filter(p => p.team === 1);
      const teamB = gameState.players.filter(p => p.team === 2);

      gameState.teamATotalValue = teamA.reduce((sum, p) => sum + p.value, 0);
      gameState.teamBTotalValue = teamB.reduce((sum, p) => sum + p.value, 0);

      const totalPot = gameState.teamATotalValue + gameState.teamBTotalValue;

      // Update displays
      document.getElementById('pot-display').textContent = '$' + totalPot.toLocaleString();
      document.getElementById('team-a-value').textContent = '$' + gameState.teamATotalValue.toLocaleString();
      document.getElementById('team-b-value').textContent = '$' + gameState.teamBTotalValue.toLocaleString();

      // Update bar fills
      const maxValue = Math.max(gameState.teamATotalValue, gameState.teamBTotalValue, 1);
      const aPercent = (gameState.teamATotalValue / maxValue) * 100;
      const bPercent = (gameState.teamBTotalValue / maxValue) * 100;

      gsap.to('#team-a-fill', { width: aPercent + '%', duration: 0.5, ease: 'power2.out' });
      gsap.to('#team-b-fill', { width: bPercent + '%', duration: 0.5, ease: 'power2.out' });
    }

    // ============================================
    // START BATTLE
    // ============================================
    async function startBattle() {
      gameState.battleStarted = true;

      // Reveal each player sequentially
      for (const player of gameState.players) {
        await revealPlayerCard(player.id);
        await new Promise(r => setTimeout(r, 400));
      }

      // Show winner
      const winner = gameState.teamATotalValue > gameState.teamBTotalValue ? 'A' : 'B';
      showWinner(winner);
    }

    // ============================================
    // WINNER SCREEN
    // ============================================
    function showWinner(team) {
      document.getElementById('winner-text').textContent = `TEAM ${team} WINS!`;
      document.getElementById('winner-overlay').classList.add('active');

      // Screen shake
      gsap.to(document.body, {
        x: 10,
        duration: 0.05,
        repeat: 10,
        yoyo: true,
        ease: 'power2.out'
      });

      // Confetti
      createConfetti();
    }

    // ============================================
    // CONFETTI
    // ============================================
    function createConfetti() {
      const canvas = document.getElementById('confetti-canvas');
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      const particles = [];
      for (let i = 0; i < 100; i++) {
        particles.push({
          x: Math.random() * canvas.width,
          y: -10,
          vx: (Math.random() - 0.5) * 8,
          vy: Math.random() * 5 + 5,
          life: 1,
          color: ['#00ffff', '#ffd700', '#8a2be2'][Math.floor(Math.random() * 3)]
        });
      }

      function animateConfetti() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        particles.forEach((p, i) => {
          p.x += p.vx;
          p.y += p.vy;
          p.vy += 0.1; // gravity
          p.life -= 0.01;

          if (p.life > 0) {
            ctx.globalAlpha = p.life;
            ctx.fillStyle = p.color;
            ctx.fillRect(p.x, p.y, 6, 6);
          } else {
            particles.splice(i, 1);
          }
        });

        if (particles.length > 0) {
          requestAnimationFrame(animateConfetti);
        }
      }

      animateConfetti();
    }

    // ============================================
    // INIT
    // ============================================
    document.addEventListener('DOMContentLoaded', () => {
      loadBattleFromAPI();

      // Add click handler to start
      document.querySelector('.btn-primary').addEventListener('click', () => {
        if (gameState.phase === 'waiting') {
          startBattle();
        }
      });
    });
  </script>
</body>
</html>
